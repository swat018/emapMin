(()=>{"use strict";function t(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}var e="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},r={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},n={};n[r.DEGREES]=2*Math.PI*6370997/360,n[r.FEET]=.3048,n[r.METERS]=1,n[r.USFEET]=1200/3937;const o=r;var i=function(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit};i.prototype.canWrapX=function(){return this.canWrapX_},i.prototype.getCode=function(){return this.code_},i.prototype.getExtent=function(){return this.extent_},i.prototype.getUnits=function(){return this.units_},i.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||n[this.units_]},i.prototype.getWorldExtent=function(){return this.worldExtent_},i.prototype.getAxisOrientation=function(){return this.axisOrientation_},i.prototype.isGlobal=function(){return this.global_},i.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},i.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},i.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},i.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},i.prototype.setWorldExtent=function(t){this.worldExtent_=t},i.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},i.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};const a=i;var s=6378137,l=Math.PI*s,c=[-l,-l,l,l],u=[-180,-85,180,85],p=function(t){function r(r){t.call(this,{code:r,units:o.METERS,extent:c,global:!0,worldExtent:u,getPointResolution:function(t,r){return t/e(r[1]/s)}})}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r}(a),h=[new p("EPSG:3857"),new p("EPSG:102100"),new p("EPSG:102113"),new p("EPSG:900913"),new p("urn:ogc:def:crs:EPSG:6.18:3:3857"),new p("urn:ogc:def:crs:EPSG::3857"),new p("http://www.opengis.net/gml/srs/epsg.xml#3857")];var d,g,m,y=[-180,-90,180,90],f=6378137*Math.PI/180,v=function(t){function e(e,r){t.call(this,{code:e,units:o.DEGREES,extent:y,axisOrientation:r,global:!0,metersPerUnit:f,worldExtent:y})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(a),_=[new v("CRS:84"),new v("EPSG:4326","neu"),new v("urn:ogc:def:crs:EPSG::4326","neu"),new v("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new v("urn:ogc:def:crs:OGC:1.3:CRS84"),new v("urn:ogc:def:crs:OGC:2:84"),new v("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new v("urn:x-ogc:def:crs:EPSG:4326","neu")],w={},S={};function L(t,e,r){var n=t.getCode(),o=e.getCode();n in S||(S[n]={}),S[n][o]=r}function P(t,e,r){var n;if(void 0!==e){for(var o=0,i=t.length;o<i;++o)e[o]=t[o];n=e}else n=t.slice();return n}function E(t,e,r){if(void 0!==e&&t!==e){for(var n=0,o=t.length;n<o;++n)e[n]=t[n];t=e}return t}function x(t){!function(t,e){w[t]=e}(t.getCode(),t),L(t,t,P)}function b(t){return"string"==typeof t?w[t]||null:t||null}function I(t){!function(t){t.forEach(x)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&L(e,t,P)}))}))}function T(t,e){return function(t,e,r){return function(t,e){return r=b(t),n=b(e),o=function(t,e){var r;return t in S&&e in S[t]&&(r=S[t][e]),r}(r.getCode(),n.getCode()),o||(o=E),o;var r,n,o}(e,r)(t,void 0,t.length)}(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")}function F(t,e,r){const[n,o]=e,i=Math.floor(n),a=Math.floor(o),s=Math.ceil(n),l=Math.ceil(o),c=n-i,u=o-a,p=r[s+t*a],h=r[i+t*a],d=r[i+t*l];return(p-h)*c+(d-h)*u+(h+r[s+t*l]-p-d)*c*u+h}I(h),I(_),d=h,g=function(t,e,r){var n=t.length,o=r>1?r:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(n));for(var a=l,c=0;c<n;c+=o){i[c]=a*t[c]/180;var u=s*Math.log(Math.tan(Math.PI*(t[c+1]+90)/360));u>a?u=a:u<-a&&(u=-a),i[c+1]=u}return i},m=function(t,e,r){var n=t.length,o=r>1?r:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(n));for(var a=0;a<n;a+=o)i[a]=180*t[a]/l,i[a+1]=360*Math.atan(Math.exp(t[a+1]/s))/Math.PI-90;return i},_.forEach((function(t){d.forEach((function(e){L(t,e,g),L(e,t,m)}))}));class R{constructor(t,e,r,n,o){this.extent=function(t,e){return t.slice()}(o),this.dataWidth_=r,this.dataHeight_=n,this.speedBuffer_=new Float32Array(t.length),this.simpleSpeedBuffer=new Uint8Array(t.length),this.rotationBuffer_=new Float32Array(t.length),this.uBuffer_=t,this.vBuffer_=e;for(let r=0;r<t.length;++r){const n=t[r],o=e[r],i=Math.sqrt(n*n+o*o),a=Math.atan2(o,n);this.speedBuffer_[r]=i,this.simpleSpeedBuffer[r]=Math.ceil(i),this.rotationBuffer_[r]=a}}getUVSpeed(t){const e=this.dataWidth_,r=this.dataHeight_,n=function(t,e,r,n){return[(n[0]-t[0])/(t[2]-t[0])*(e-1),(Math.atan(Math.sinh(n[1]/6378137))*(180/Math.PI)+90)/180*(r-1)]}(this.extent,e,r,t);return[F(e,n,this.uBuffer_),F(e,n,this.vBuffer_)]}getRotation(t){return this.rotationBuffer_[t]}getSpeed(t){return this.speedBuffer_[t]}}var C="function"==typeof Object.assign?Object.assign:function(t,e){var r=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),o=1,i=arguments.length;o<i;++o){var a=r[o];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(n[s]=a[s])}return n};function M(t){for(var e in t)delete t[e]}function k(t,e,r,n){for(var o,i=0,a=t.length;i<a;++i)if((o=t[i]).listener===e&&o.bindTo===r)return n&&(o.deleteIndex=i),o}function O(t,e){var r=B(t);return r?r[e]:void 0}function B(t,e){var r=t.ol_lm;return!r&&e&&(r=t.ol_lm={}),r}function A(t,e){var r=O(t,e);if(r){for(var n=0,o=r.length;n<o;++n)t.removeEventListener(e,r[n].boundListener),M(r[n]);r.length=0;var i=B(t);i&&(delete i[e],0===Object.keys(i).length&&function(t){delete t.ol_lm}(t))}}function z(t,e,r,n,o){var i=B(t,!0),a=i[e];a||(a=i[e]=[]);var s=k(a,r,n,!1);return s?o||(s.callOnce=!1):(s={bindTo:n,callOnce:!!o,listener:r,target:t,type:e},t.addEventListener(e,function(t){var e=function(e){var r=t.listener,n=t.bindTo||t.target;return t.callOnce&&Z(t),r.call(n,e)};return t.boundListener=e,e}(s)),a.push(s)),s}function G(t,e,r,n){return z(t,e,r,n,!0)}function D(t,e,r,n){var o=O(t,e);if(o){var i=k(o,r,n,!0);i&&Z(i)}}function Z(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=O(t.target,t.type);if(e){var r="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==r&&e.splice(r,1),0===e.length&&A(t.target,t.type)}M(t)}}const N="change";function W(){return function(){throw new Error("Unimplemented abstract method.")}()}var X=0;function U(t){return t.ol_uid||(t.ol_uid=String(++X))}var Y=function(){this.disposed_=!1};Y.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},Y.prototype.disposeInternal=function(){};const j=Y;function V(){}var $=function(t){this.propagationStopped,this.type=t,this.target=null};$.prototype.preventDefault=function(){this.propagationStopped=!0},$.prototype.stopPropagation=function(){this.propagationStopped=!0};const K=$;var H=function(t){function e(){t.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addEventListener=function(t,e){var r=this.listeners_[t];r||(r=this.listeners_[t]=[]),-1===r.indexOf(e)&&r.push(e)},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new K(t):t,r=e.type;e.target=this;var n,o=this.listeners_[r];if(o){r in this.dispatching_||(this.dispatching_[r]=0,this.pendingRemovals_[r]=0),++this.dispatching_[r];for(var i=0,a=o.length;i<a;++i)if(!1===o[i].call(this,e)||e.propagationStopped){n=!1;break}if(--this.dispatching_[r],0===this.dispatching_[r]){var s=this.pendingRemovals_[r];for(delete this.pendingRemovals_[r];s--;)this.removeEventListener(r,V);delete this.dispatching_[r]}return n}},e.prototype.disposeInternal=function(){!function(t){var e=B(t);if(e)for(var r in e)A(t,r)}(this)},e.prototype.getListeners=function(t){return this.listeners_[t]},e.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.prototype.removeEventListener=function(t,e){var r=this.listeners_[t];if(r){var n=r.indexOf(e);t in this.pendingRemovals_?(r[n]=V,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t])}},e}(j);const q=function(t){function e(){t.call(this),this.revision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){++this.revision_,this.dispatchEvent(N)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=z(this,t[o],e);return n}return z(this,t,e)},e.prototype.once=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),o=0;o<r;++o)n[o]=G(this,t[o],e);return n}return G(this,t,e)},e.prototype.un=function(t,e){if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)D(this,t[r],e);else D(this,t,e)},e}(H);var J=function(t){function e(e,r,n){t.call(this,e),this.key=r,this.oldValue=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(K),Q={};function tt(t){return Q.hasOwnProperty(t)?Q[t]:Q[t]="change:"+t}const et="opacity",rt="visible",nt="extent",ot="zIndex",it="maxResolution",at="minResolution",st="source";var lt=function(t){function e(e){t.call(this);var r=C({},e);r[et]=void 0!==e.opacity?e.opacity:1,r[rt]=void 0===e.visible||e.visible,r[ot]=e.zIndex,r[it]=void 0!==e.maxResolution?e.maxResolution:1/0,r[at]=void 0!==e.minResolution?e.minResolution:0,this.setProperties(r),this.state_=null,this.type}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return this.type},e.prototype.getLayerState=function(){var t,e=this.state_||{layer:this,managed:!0};return e.opacity=(t=this.getOpacity(),0,1,Math.min(Math.max(t,0),1)),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=this.getZIndex()||0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),this.state_=e,e},e.prototype.getLayersArray=function(t){return W()},e.prototype.getLayerStatesArray=function(t){return W()},e.prototype.getExtent=function(){return this.get(nt)},e.prototype.getMaxResolution=function(){return this.get(it)},e.prototype.getMinResolution=function(){return this.get(at)},e.prototype.getOpacity=function(){return this.get(et)},e.prototype.getSourceState=function(){return W()},e.prototype.getVisible=function(){return this.get(rt)},e.prototype.getZIndex=function(){return this.get(ot)},e.prototype.setExtent=function(t){this.set(nt,t)},e.prototype.setMaxResolution=function(t){this.set(it,t)},e.prototype.setMinResolution=function(t){this.set(at,t)},e.prototype.setOpacity=function(t){this.set(et,t)},e.prototype.setVisible=function(t){this.set(rt,t)},e.prototype.setZIndex=function(t){this.set(ot,t)},e}(function(t){function e(e){t.call(this),U(this),this.values_={},void 0!==e&&this.setProperties(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return Object.keys(this.values_)},e.prototype.getProperties=function(){return C({},this.values_)},e.prototype.notify=function(t,e){var r;r=tt(t),this.dispatchEvent(new J(r,t,e)),r="propertychange",this.dispatchEvent(new J(r,t,e))},e.prototype.set=function(t,e,r){if(r)this.values_[t]=e;else{var n=this.values_[t];this.values_[t]=e,n!==e&&this.notify(t,n)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.unset=function(t,e){if(t in this.values_){var r=this.values_[t];delete this.values_[t],e||this.notify(t,r)}},e}(q));var ct=function(t){function e(e){var r=C({},e);delete r.source,t.call(this,r),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),z(this,tt(st),this.handleSourcePropertyChange_,this);var n=e.source?e.source:null;this.setSource(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(st)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():"undefined"},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(Z(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=z(t,N,this.handleSourceChange_,this)),this.changed()},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(Z(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Z(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=z(t,"precompose",(function(t){var e=t,r=this.getLayerState();r.managed=!1,void 0===this.getZIndex()&&(r.zIndex=1/0),e.frameState.layerStatesArray.push(r),e.frameState.layerStates[U(this)]=r}),this),this.mapRenderKey_=z(this,N,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(st,t)},e}(lt);const ut=ct;function pt(t,e){let[r,n]=t.size;if(r*=t.pixelRatio,n*=t.pixelRatio,e.width!==r||e.height!==n)return e.width=r,e.height=n,!0}function ht(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}new Array(6);const dt=[];class gt extends q{constructor(t){super(),this.layer=t,this.canvases_=[document.createElement("canvas"),document.createElement("canvas")],this.previousFrame_={canvasId:0,centerX:0,centerY:0,resolution:1/0}}static handles(t){return t instanceof mt}static create(t,e){return new gt(e)}prepareFrame(t){const e=this.layer,r=this.canvases_[this.previousFrame_.canvasId];let n=r;const o=pt(t,r);let i=this.previousFrame_.canvasId;const[a,s]=t.viewState.center,l=t.viewState.resolution;if(!o&&this.previousFrame_.resolution===l){dt[0]=this.previousFrame_.centerX,dt[1]=this.previousFrame_.centerY,ht(t.coordinateToPixelTransform,dt);const e=dt[0]-t.size[0]/2,o=dt[1]-t.size[1]/2;if(0!==e||0!==o){i=(i+1)%2,n=this.canvases_[i],pt(t,n);const a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),a.drawImage(r,e,o)}}this.previousFrame_.canvasId=i,this.previousFrame_.centerX=a,this.previousFrame_.centerY=s,this.previousFrame_.resolution=l;const c=n.getContext("2d");return e.doRender_(t,c),t.animate=!0,!0}composeFrame(t,e,r){const n=this.canvases_[this.previousFrame_.canvasId],o=n.width,i=n.height;r.drawImage(n,0,0,o,i)}}class mt extends ut{constructor(t){super({}),this.doRender_=t.renderFunction}getSourceState(){return"ready"}}function yt(t,e){var r,n;e[0]=Math.random()*function(t){return t[2]-t[0]}(t)+t[0],e[1]=(r=Math.random(),n=Math.PI*(r-.5),Math.log(Math.tan(Math.PI/4+n/2))/Math.PI*20037508.34)}class ft extends mt{constructor(t){super({renderFunction:(e,r)=>{let n;return n=t.uvBuffer1?"dimgray":4==t.brightMode?"#777777":"white",this.render(e,r,n)}}),this.fading=t.fading||.8,console.assert(t.ttl),this.ttl=t.ttl,console.assert(t.map),this.map=t.map,console.assert(t.particleSize1),console.assert(t.particleSize2),this.particleSize1=t.particleSize1,this.particleSize2=t.particleSize2;const e=[t.uvBuffer1,t.uvBuffer2,t.uvBuffer3];for(const t of e)if(t){console.assert(t),this.uvBuffer=t;break}console.assert(t.particles),this.particles=new Array(t.particles);for(let e=0;e<t.particles;++e)this.particles[e]={ttl:Math.random()*this.ttl,coordinates:[]};this.pixel=[],this.viewportWithDataExtent=[1/0,1/0,-1/0,-1/0],this.map.getRenderer().registerLayerRenderers([gt])}render(t,e,r){const n=e.canvas;e.fillStyle=r,this.advanceParticles(t,e),e.globalAlpha=this.fading,e.globalCompositeOperation="destination-in",e.fillRect(0,0,n.width,n.height),e.globalAlpha=1,e.globalCompositeOperation="source-over"}advanceParticles(t,e){if(n=this.uvBuffer.extent,o=t.extent,i=this.viewportWithDataExtent,a=i||[1/0,1/0,-1/0,-1/0],function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}(n,o)?(n[0]>o[0]?a[0]=n[0]:a[0]=o[0],n[1]>o[1]?a[1]=n[1]:a[1]=o[1],n[2]<o[2]?a[2]=n[2]:a[2]=o[2],n[3]<o[3]?a[3]=n[3]:a[3]=o[3]):function(t){!function(t,e,r,n,o){o&&(o[0]=t,o[1]=e,o[2]=r,o[3]=n)}(1/0,1/0,-1/0,-1/0,t)}(a),(r=this.viewportWithDataExtent)[2]<r[0]||r[3]<r[1])return;var r,n,o,i,a;const s=this.pixel,l=t.viewState.resolution,c=t.pixelRatio;this.particles.forEach((r=>{var n;0!==r.coordinates.length&&function(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}(this.viewportWithDataExtent,(n=r.coordinates)[0],n[1])||yt(this.viewportWithDataExtent,r.coordinates),s[0]=r.coordinates[0],s[1]=r.coordinates[1];const[o,i]=this.uvBuffer.getUVSpeed(r.coordinates);if(0!==o&&0!==i){ht(t.coordinateToPixelTransform,s);const n=function(t,e){return Math.atan2(t,e)*(180/Math.PI)}(o,i);e.save(),e.translate(s[0]*c,s[1]*c),e.rotate(n*Math.PI/180),r.ttl>this.ttl/2?e.globalAlpha=2*(1-r.ttl/this.ttl):e.globalAlpha=r.ttl/this.ttl*2,e.fillRect(-this.particleSize1*c/2,-this.particleSize2*c/2,this.particleSize1*c,this.particleSize2*c),e.restore()}--r.ttl,r.ttl<0&&(yt(this.viewportWithDataExtent,r.coordinates),r.ttl=this.ttl),r.coordinates[0]+=o*l,r.coordinates[1]+=i*l}))}}let vt,_t,wt,St=.5,Lt=4;const Pt="/{z}/{x}/{-y}.png";let Et,xt,bt,It,Tt,Ft,Rt,Ct,Mt,kt,Ot,Bt,At,zt,Gt,Dt,Zt,Nt,Wt,Xt=1,Ut=1,Yt=new Date;var jt,Vt,$t,Kt,Ht;function qt(){Jt(!0),document.getElementById("weatherTime").innerText=oe(Yt),Gt||Dt||Zt?le(!1):(Nt||Wt)&&le(!0)}function Jt(t){if(4!=Xt&&(map.removeLayer(_t),_t=null),Gt)t||(Gt=!1),map.removeLayer(kt),kt=null;else if(Dt)t||(Dt=!1),map.removeLayer(Ot),Ot=null;else if(Zt)t||(Zt=!1),map.removeLayer(Bt),Bt=null;else if((Nt||Wt)&&(Nt?(t||(Nt=!1),map.removeLayer(At),At=null):Wt&&(t||(Wt=!1),map.removeLayer(zt),zt=null),!t)){const t=document.querySelector("#tempLegend");t&&t.remove()}}function Qt(){const t=document.createElement("div");t.id="tempLegend",t.style.position="absolute",t.style.top="30px",t.style.right="0px",t.style.width="45px",t.style.height="162px",t.style.backgroundImage="url(images/emap/legend_temp.png)",t.style.opacity="1",document.body.appendChild(t)}function te(){1==Xt?1==Ut?(ce(),Et.setZIndex(-1)):2==Ut?(xt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Day_Standard"+Pt})}),map.addLayer(xt),xt.setZIndex(-1)):(bt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Day_Full"+Pt})}),map.addLayer(bt),bt.setZIndex(-1)):2==Xt?1==Ut?(It=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Dusk_Base"+Pt})}),map.addLayer(It),It.setZIndex(-1)):2==Ut?(Tt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Dusk_Standard"+Pt})}),map.addLayer(Tt),Tt.setZIndex(-1)):(Ft=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Dusk_Full"+Pt})}),map.addLayer(Ft),Ft.setZIndex(-1)):3==Xt&&(1==Ut?(Rt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Night_Base"+Pt})}),map.addLayer(Rt),Rt.setZIndex(-1)):2==Ut?(Ct=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Night_Standard"+Pt})}),map.addLayer(Ct),Ct.setZIndex(-1)):(Mt=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Night_Full"+Pt})}),map.addLayer(Mt),Mt.setZIndex(-1)))}function ee(){St=0===Lt?1:.5}let re;function ne(){switch(console.log("lev : "+Lt),Lt){case 5:wt=400;break;case 6:wt=600;break;case 7:wt=1100;break;case 8:wt=2200;break;case 9:wt=3900;break;case 10:wt=7800;break;case 11:case 12:wt=16e3;break;case 13:wt=32e3;break;case 14:wt=64e3;break;case 15:wt=128e3;break;default:wt=300}console.log("radius : "+wt)}function oe(t){let e=t.getFullYear(),r=t.getMonth()+1,n=t.getDate();r=r<10?"0"+r:r,n=n<10?"0"+n:n;let o=t.getHours();return o=3*parseInt(o/3)+"시",o=o<10?"0"+o:o,e+"-"+r+"-"+n+" "+o}function ie(t){Yt.setHours(Yt.getHours()+t)}var ae;ce(),jt=document.getElementById("checkWind"),Vt=document.getElementById("checkFlow"),$t=document.getElementById("checkWave"),Kt=document.getElementById("checkTempair"),Ht=document.getElementById("checkTempwater"),jt.addEventListener("change",(function(){jt.checked&&(Jt(!1),Gt=!0,le(!1))})),Vt.addEventListener("change",(function(){Vt.checked&&(Jt(!1),Dt=!0,le(!1))})),$t.addEventListener("change",(function(){$t.checked&&(Jt(!1),Zt=!0,le(!1))})),Kt.addEventListener("change",(function(){Kt.checked&&(Jt(!1),Nt=!0,le(!0),Qt())})),Ht.addEventListener("change",(function(){Ht.checked&&(Jt(!1),Wt=!0,le(!0),Qt())})),(ae=document.getElementById("brightSelect")).addEventListener("change",(function(){const t=[Et,It,Rt],e=[xt,Tt,Ct],r=[bt,Ft,Mt];let n=map.getLayers().getArray();const o=t=>{n.includes(t)&&(map.removeLayer(t),t=null)};t.forEach(o),e.forEach(o),r.forEach(o),map.removeLayer(vt),vt=null,map.removeLayer(_t),_t=null;var i=ae.value;Xt=i,4==Xt?(vt=new ol.layer.Tile({id:"ocean",title:"ocean",opacity:1,source:new ol.source.TileWMS({url:geoserverWmsUrl,serverType:"geoserver",crossOrigin:"anonymous",params:{VERSION:"1.1.0",LAYERS:"emap:ocean",CRS:"EPSG:3857"}})}),map.addLayer(vt),vt.setZIndex(-1),pe("ocean","Polygon1_1","17284F",null),_t=new ol.layer.Tile({id:"worldcountries",title:"worldcountries",opacity:1,source:new ol.source.TileWMS({url:geoserverWmsUrl,serverType:"geoserver",crossOrigin:"anonymous",params:{VERSION:"1.1.0",LAYERS:"emap:worldcountries",CRS:"EPSG:3857"}})}),map.addLayer(_t),_t.setZIndex(1),pe("worldcountries","Polygon1_2","1E1E1E","6689CA")):te(),4!=Xt&&(Dt||Zt||Wt)&&ue()})),document.getElementById("modeSelect").addEventListener("change",(function(){const t=[Et,It,Rt],e=[xt,Tt,Ct],r=[bt,Ft,Mt];let n=map.getLayers().getArray();const o=t=>{n.includes(t)&&(map.removeLayer(t),t=null)};t.forEach(o),e.forEach(o),r.forEach(o);var i=event.target.value;"1"===i?Ut=1:"2"===i?Ut=2:"3"===i&&(Ut=3),te()})),map.on("movestart",(function(){4!=Xt&&(map.removeLayer(_t),_t=null),Gt?(map.removeLayer(kt),kt=null):Dt?(map.removeLayer(Ot),Ot=null):Zt?(map.removeLayer(Bt),Bt=null):Nt?At.setZIndex(-1):Wt&&zt.setZIndex(-1)})),map.on("moveend",(function(){ee(),Gt||Dt||Zt?(Gt?(map.removeLayer(kt),kt=null):Dt?(map.removeLayer(Ot),Ot=null):Zt&&(map.removeLayer(Bt),Bt=null),le(!1)):(Nt||Wt)&&(Nt?(ne(),he("tb_tempair",wt),At.setZIndex(1)):Wt&&(ne(),he("tb_tempwater",wt),zt.setZIndex(1)))})),map.getView().on("change:resolution",(function(){Lt=map.getView().getZoom(),clearTimeout(re),re=setTimeout((function(){Number.isInteger(Lt)&&ee()}),250)})),function(){let t=null;document.querySelectorAll(".customRadio").forEach((function(e){e.addEventListener("click",(function(){this===t?(this.checked=!1,t=null,Jt(!1)):t=this}))}))}(),document.getElementById("weatherTime").innerText=oe(Yt),document.getElementById("timeMinus12").addEventListener("click",(function(){ie(-12),qt()})),document.getElementById("timeMinus3").addEventListener("click",(function(){ie(-3),qt()})),document.getElementById("timeNow").addEventListener("click",(function(){Yt=new Date,qt()})),document.getElementById("timePlus3").addEventListener("click",(function(){ie(3),qt()})),document.getElementById("timePlus12").addEventListener("click",(function(){ie(12),qt()})),dateInput=document.getElementById("selectDate"),dateInput.addEventListener("change",(function(t){let e=new Date(t.target.value);Yt=e,qt()}));let se=null;function le(e){let r=oe(Yt);let n=[1/0,1/0,-1/0,-1/0];!async function(r){se&&se.abort(),se=new AbortController;const{signal:a}=se;let s=map.getView().calculateExtent(map.getSize()),l=ol.proj.transform(ol.extent.getBottomLeft(s),"EPSG:3857","EPSG:4326"),c=ol.proj.transform(ol.extent.getTopRight(s),"EPSG:3857","EPSG:4326"),u=90,p=l[0],h=c[0];e&&(u=c[1]+St,p-=St);let d,g=r.slice(0,10).replace(/-/g,""),m=r.slice(11,13);m.endsWith("시")&&(m=m.charAt(0)),Gt?d=`./api/weather/wind?date=${g}&time=${m}&lat1=-90&lat2=${u}&lon1=${p}&lon2=${h}&degree=${St}&data=0`:Dt||Zt?d=`./api/weather/all?date=${g}&time=${m}&lat1=-90&lat2=${u}&lon1=${p}&lon2=${h}&degree=${St}&data=0`:Nt?d=`./api/weather/tempair?date=${g}&time=${m}`:Wt&&(d=`./api/weather/tempwater?date=${g}&time=${m}`);let y=document.getElementById("weatherStatus");y.innerHTML="데이터 다운로드 중입니다.";try{await async function(t,e,r){let n=0;let a=document.getElementById("weatherStatus");for(n=0;n<3;n++){const r=new AbortController,s=r.signal,l=fetch(t,{...e,signal:s}),c=setTimeout((()=>r.abort()),3e4);try{const t=await l;return clearTimeout(c),t.ok||(a.innerHTML="서버 응답이 없습니다."),o=await t.json(),a.innerHTML="",i=!0,void console.log(i)}catch(t){clearTimeout(c),n<2?(t.name,a.innerHTML=`데이터 다운로드 재시도 (${n+1})`):a.innerHTML="데이터 다운로드에 실패하였습니다."}}}(d,{signal:a});let r=0,s=0;if(!e){var f=new Set,v=new Set;o.forEach((function(t){t.hasOwnProperty("lat")&&f.add(t.lat),t.hasOwnProperty("lon")&&v.add(t.lon)})),r=v.size,s=f.size}i&&function(e,r,i){if(Gt?(map.removeLayer(kt),kt=null):Dt?(map.removeLayer(Ot),Ot=null):Zt?(map.removeLayer(Bt),Bt=null):At?(map.removeLayer(At),At=null):zt&&(map.removeLayer(zt),zt=null),!e){const a=[],s=[];function l(t,e){return t.map((t=>t[e]))}const c=l(o,"lat"),u=l(o,"lon");let p,h,d,g,m,y,f;Gt?(p=l(o,"ugrd10m"),h=l(o,"vgrd10m"),o=null):Dt?(p=l(o,"u_current"),h=l(o,"v_current"),o=null):Zt&&(p=l(o,"fwaveu"),h=l(o,"fwavev"),o=null);for(let v=0;v<c.length;v++){const _=T([parseFloat(u[v]),parseFloat(c[v])]);let w,S;Gt?(w=p[v]/5,S=h[v]/5,a.push(w),s.push(S)):Dt?(w=p[v],S=h[v],a.push(w),s.push(S)):Zt&&(w=p[v]/70,S=h[v]/70,a.push(w),s.push(S)),t(n,_)}(Gt||Dt||Zt)&&(d=new Float32Array(a),g=new Float32Array(s),Gt?m=new R(d,g,r,i,n):Dt?y=new R(d,g,r,i,n):f=new R(d,g,r,i,n)),Gt?kt=new ft({map,uvBuffer1:m,particles:1e4,fading:.98,ttl:400,particleSize1:1.5,particleSize2:1.5,brightMode:Xt}):Dt?Ot=new ft({map,uvBuffer2:y,particles:2e4,fading:.95,ttl:400,particleSize1:1.5,particleSize2:1.5,brightMode:Xt}):Zt&&(Bt=new ft({map,uvBuffer3:f,particles:1e4,fading:.45,ttl:150,particleSize1:6,particleSize2:3,brightMode:Xt}))}Gt?(map.addLayer(kt),4==Xt&&_t.setZIndex(-1)):Dt?(map.addLayer(Ot),ue()):Zt?(map.addLayer(Bt),ue()):Nt?(At=new ol.layer.Image({id:"tb_tempair",title:"tb_tempair",opacity:1,source:new ol.source.ImageWMS({url:geoserverWmsUrl,serverType:"geoserver",crossOrigin:"anonymous",params:{VERSION:"1.3.0",LAYERS:"emap:tb_tempair",CRS:"EPSG:4326"}})}),map.addLayer(At),ne(),he("tb_tempair",wt),4==Xt&&_t.setZIndex(-1)):Wt&&(zt=new ol.layer.Image({id:"tb_tempwater",title:"tb_tempwater",opacity:1,source:new ol.source.ImageWMS({url:geoserverWmsUrl,serverType:"geoserver",crossOrigin:"anonymous",params:{VERSION:"1.3.0",LAYERS:"emap:tb_tempwater",CRS:"EPSG:4326"}})}),map.addLayer(zt),ne(),he("tb_tempwater",wt),ue())}(e,r,s)}catch(t){return void(y.innerHTML="데이터 다운로드에 실패하였습니다.")}}(r);let o,i=!1}function ce(){Et=new ol.layer.Tile({source:new ol.source.XYZ({url:urlBefore+"Day_Base"+Pt})}),map.addLayer(Et)}function ue(){4==Xt&&_t.setZIndex(1)}function pe(t,e,r,n){var o="\t\t\t\t\t<?xml version='1.0' encoding='UTF-8'?>\t\t\t\t\t<StyledLayerDescriptor version='1.0.0' \t\t\t\t\t xsi:schemaLocation='http://www.opengis.net/sld StyledLayerDescriptor.xsd' \t\t\t\t\t xmlns='http://www.opengis.net/sld' \t\t\t\t\t xmlns:ogc='http://www.opengis.net/ogc' \t\t\t\t\t xmlns:xlink='http://www.w3.org/1999/xlink' \t\t\t\t\t xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'>\t\t\t\t\t  <NamedLayer>\t\t\t\t\t    <Name>emap:"+t+"</Name>\t\t\t\t\t    <UserStyle>\t\t\t\t\t      <Title>Default Polygon</Title>\t\t\t\t\t      <Abstract>A sample style that draws a polygon</Abstract>\t\t\t\t\t      <FeatureTypeStyle>\t\t\t\t\t        <Rule>\t\t\t\t\t";"Polygon1"==e?o+="\t\t\t\t\t          <PolygonSymbolizer>            \t\t\t\t\t<Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t":"Polygon1_1"==e?o+="\t\t\t\t\t          <PolygonSymbolizer>            \t\t\t\t\t<Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+r+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t":"Polygon1_2"==e?o+="\t\t\t\t\t          <PolygonSymbolizer>            \t\t\t\t\t<Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+n+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t":"Polygon2"==e&&(o+="\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+r+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>0</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t        </Rule>\t\t\t\t\t\t\t<Rule>\t\t\t\t\t          <Title>0to20</Title>\t\t\t\t\t          <ogc:Filter>\t\t\t\t\t            <ogc:And>\t\t\t\t\t              <ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>0</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t              <ogc:PropertyIsLessThan>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>20</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsLessThan>\t\t\t\t\t            </ogc:And>\t\t\t\t\t          </ogc:Filter>\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+r+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+r+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t        </Rule>\t\t\t\t\t        <Rule>\t\t\t\t\t          <Title>20to100</Title>\t\t\t\t\t          <ogc:Filter>\t\t\t\t\t            <ogc:And>\t\t\t\t\t              <ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>20</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t              <ogc:PropertyIsLessThan>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>100</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsLessThan>\t\t\t\t\t            </ogc:And>\t\t\t\t\t          </ogc:Filter>\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+n+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+n+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t        </Rule>\t\t\t\t\t        <Rule>\t\t\t\t\t          <Title>100great</Title>\t\t\t\t\t          <ogc:Filter>\t\t\t\t\t              <ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t                <ogc:PropertyName>DRVAL1</ogc:PropertyName>\t\t\t\t\t                <ogc:Literal>100</ogc:Literal>\t\t\t\t\t              </ogc:PropertyIsGreaterThanOrEqualTo>\t\t\t\t\t          </ogc:Filter>\t\t\t\t\t          <PolygonSymbolizer>\t\t\t\t\t            <Fill>\t\t\t\t\t              <CssParameter name='fill'>#"+n+"</CssParameter>\t\t\t\t\t            </Fill>\t\t\t\t\t            <Stroke>\t\t\t\t\t              <CssParameter name='stroke'>#"+n+"</CssParameter>\t\t\t\t\t              <CssParameter name='stroke-width'>1</CssParameter>\t\t\t\t\t            </Stroke>\t\t\t\t\t          </PolygonSymbolizer>\t\t\t\t\t"),o+="\t\t\t\t        </Rule>\t\t\t\t      </FeatureTypeStyle>\t\t\t\t    </UserStyle>\t\t\t\t  </NamedLayer>\t\t\t\t</StyledLayerDescriptor>\t\t\t\t",getLayer(t).getSource().updateParams({STYLES:"",SLD_BODY:o})}function he(t,e){var r="\t\t\t\t<?xml version='1.0' encoding='ISO-8859-1'?>\t\t\t\t<StyledLayerDescriptor version='1.0.0'\t\t\t\t\txsi:schemaLocation='http://www.opengis.net/sld StyledLayerDescriptor.xsd'\t\t\t\t\txmlns='http://www.opengis.net/sld' \t\t\t\t\txmlns:ogc='http://www.opengis.net/ogc'\t\t\t\t\txmlns:xlink='http://www.w3.org/1999/xlink'\t\t\t\t\txmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'>\t\t\t\t<NamedLayer>\t\t\t\t\t<Name>emap:"+t+"</Name>\t\t\t\t\t<UserStyle>\t\t\t\t\t<Title>Heatmap</Title>\t\t\t\t\t<Abstract>A heatmap surface showing population density</Abstract>\t\t\t\t\t<FeatureTypeStyle>\t\t\t\t\t\t<Transformation>\t\t\t\t\t\t<ogc:Function name='vec:Heatmap'>\t\t\t\t\t\t\t<ogc:Function name='parameter'>\t\t\t\t\t\t\t<ogc:Literal>data</ogc:Literal>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t<ogc:Function name='parameter'>\t\t\t\t\t\t\t<ogc:Literal>weightAttr</ogc:Literal>\t\t\t\t\t\t\t<ogc:Literal>temp</ogc:Literal>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t<ogc:Function name='parameter'>\t\t\t\t\t\t\t<ogc:Literal>radiusPixels</ogc:Literal>\t\t\t\t\t\t\t<ogc:Function name='env'>\t\t\t\t\t\t\t\t<ogc:Literal>radius</ogc:Literal>\t\t\t\t\t\t\t\t<ogc:Literal>"+e+"</ogc:Literal>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t<ogc:Function name='parameter'>\t\t\t\t\t\t\t<ogc:Literal>pixelsPerCell</ogc:Literal>\t\t\t\t\t\t\t<ogc:Literal>20</ogc:Literal>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t<ogc:Function name='parameter'>\t\t\t\t\t\t\t<ogc:Literal>outputBBOX</ogc:Literal>\t\t\t\t\t\t\t<ogc:Function name='env'>\t\t\t\t\t\t\t\t<ogc:Literal>wms_bbox</ogc:Literal>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t<ogc:Function name='parameter'>\t\t\t\t\t\t\t<ogc:Literal>outputWidth</ogc:Literal>\t\t\t\t\t\t\t<ogc:Function name='env'>\t\t\t\t\t\t\t\t<ogc:Literal>wms_width</ogc:Literal>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t<ogc:Function name='parameter'>\t\t\t\t\t\t\t<ogc:Literal>outputHeight</ogc:Literal>\t\t\t\t\t\t\t<ogc:Function name='env'>\t\t\t\t\t\t\t\t<ogc:Literal>wms_height</ogc:Literal>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t</ogc:Function>\t\t\t\t\t\t</Transformation>\t\t\t\t\t<Rule>\t\t\t\t\t\t<RasterSymbolizer>\t\t\t\t\t\t<Geometry>\t\t\t\t\t\t\t<ogc:PropertyName>the_geom</ogc:PropertyName></Geometry>\t\t\t\t\t\t<Opacity>0.3</Opacity>\t\t\t\t\t\t<ColorMap type='ramp'>\t\t\t\t\t\t\t<ColorMapEntry color='#bbebf4' quantity='0'/>\t\t\t\t\t\t\t<ColorMapEntry color='#9fefb7' quantity='0.33'/>\t\t\t\t\t\t\t<ColorMapEntry color='#e4ef97' quantity='0.66'/>\t\t\t\t\t\t\t<ColorMapEntry color='#ec6767' quantity='1'/>\t\t\t\t\t\t</ColorMap>\t\t\t\t\t\t</RasterSymbolizer>\t\t\t\t\t\t</Rule>\t\t\t\t\t</FeatureTypeStyle>\t\t\t\t\t</UserStyle>\t\t\t\t</NamedLayer>\t\t\t\t</StyledLayerDescriptor>\t\t\t\t";getLayer(t).getSource().updateParams({STYLES:"",SLD_BODY:r})}})();